---
import { User } from "astro:db"
import { db, eq } from "astro:db"

// Get the userId from auth() -- if null, the user is not signed in
const { userId } = Astro.locals.auth()

// Protect the route by checking if the user is signed in
// if (!userId) {
//   return Astro.redirect('/login')
// }

// Get the Backend User object when you need access to the user's information
const user = await Astro.locals.currentUser()

console.log("clerk user", user)
const dbUser = await db.select().from(User).where(
    eq(User.clerkUserId, userId || "")
)
---

<!-- Use `user` to render user details or create UI elements -->
<div>Welcome, {user?.firstName}!</div>
<pre>{JSON.stringify(dbUser, null, 2)}</pre>